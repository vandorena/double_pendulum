<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Double Pendulum</title>
</head>
<body>
    <canvas id="pendulum-canvas" width="600" height="600"></canvas>
    <script>
        class DoublePendulum {
            constructor(originX = 300, originY = 100, lengthRod1 = 120, lengthRod2 = 120,
                        massBob1 = 10, massBob2 = 10, g = 9.81, theta1 = Math.PI / 2,
                        theta2 = Math.PI / 2, omega1 = 0.0, omega2 = 0.0) {
                this.originX = originX;
                this.originY = originY;
                this.lengthRod1 = lengthRod1;
                this.lengthRod2 = lengthRod2;
                this.massBob1 = massBob1;
                this.massBob2 = massBob2;
                this.g = g;
                this.theta1 = theta1;
                this.theta2 = theta2;
                this.omega1 = omega1;
                this.omega2 = omega2;
                this.x1 = this.originX + this.lengthRod1 * Math.sin(this.theta1);
                this.y1 = this.originY + this.lengthRod1 * Math.cos(this.theta1);
                this.x2 = this.x1 + this.lengthRod2 * Math.sin(this.theta2);
                this.y2 = this.y1 + this.lengthRod2 * Math.cos(this.theta2);
            }

            step(dt = 0.06) {
                const delta = this.theta2 - this.theta1;
                const denominator1 = (this.massBob1 + this.massBob2) * this.lengthRod1 - 
                                    this.massBob2 * this.lengthRod1 * Math.cos(delta) ** 2;
                const denominator2 = (this.lengthRod2 / this.lengthRod1) * denominator1;

                const acceleration1 = (this.massBob2 * this.lengthRod1 * this.omega1 ** 2 * Math.sin(delta) * Math.cos(delta) +
                                      this.massBob2 * this.g * Math.sin(this.theta2) * Math.cos(delta) +
                                      this.massBob2 * this.lengthRod2 * this.omega2 ** 2 * Math.sin(delta) -
                                      (this.massBob1 + this.massBob2) * this.g * Math.sin(this.theta1)) / denominator1;

                const acceleration2 = (-this.massBob2 * this.lengthRod2 * this.omega2 ** 2 * Math.sin(delta) * Math.cos(delta) +
                                      (this.massBob1 + this.massBob2) * this.g * Math.sin(this.theta1) * Math.cos(delta) -
                                      (this.massBob1 + this.massBob2) * this.lengthRod1 * this.omega1 ** 2 * Math.sin(delta) -
                                      (this.massBob1 + this.massBob2) * this.g * Math.sin(this.theta2)) / denominator2;

                this.omega1 += acceleration1 * dt;
                this.omega2 += acceleration2 * dt;
                this.theta1 += this.omega1 * dt;
                this.theta2 += this.omega2 * dt;

                this.x1 = this.originX + this.lengthRod1 * Math.sin(this.theta1);
                this.y1 = this.originY + this.lengthRod1 * Math.cos(this.theta1);
                this.x2 = this.x1 + this.lengthRod2 * Math.sin(this.theta2);
                this.y2 = this.y1 + this.lengthRod2 * Math.cos(this.theta2);
            }

            getCoords() {
                return [
                    { x: this.x1, y: this.y1 },
                    { x: this.x2, y: this.y2 }
                ];
            }
        }

        const canvas = document.getElementById('pendulum-canvas');
        const ctx = canvas.getContext('2d');

        const ORIGIN_X = 300;
        const ORIGIN_Y = 100;

        const doublePendulum = new DoublePendulum();

        const trail1 = [];
        const trail2 = [];
        const MAX_TRAIL = 300;

        function drawPendulum(coords) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            ctx.beginPath();
            ctx.arc(ORIGIN_X, ORIGIN_Y, 4, 0, Math.PI * 2);
            ctx.fillStyle = '#444';
            ctx.fill();

            ctx.beginPath();
            ctx.moveTo(ORIGIN_X, ORIGIN_Y);
            ctx.lineTo(coords[0].x, coords[0].y);
            ctx.lineTo(coords[1].x, coords[1].y);
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.stroke();

            for (let i = 0; i < coords.length; i++) {
                ctx.beginPath();
                ctx.arc(coords[i].x, coords[i].y, 10, 0, 2 * Math.PI);
                ctx.fillStyle = i === 0 ? '#1976d2' : '#ef6c00';
                ctx.fill();
                ctx.strokeStyle = '#222';
                ctx.stroke();
            }
        }

        function animate() {
            doublePendulum.step();
            const coords = doublePendulum.getCoords();

            trail1.push({ x: coords[0].x, y: coords[0].y });
            trail2.push({ x: coords[1].x, y: coords[1].y });
            if (trail1.length > MAX_TRAIL) trail1.shift();
            if (trail2.length > MAX_TRAIL) trail2.shift();

            drawPendulum(coords);

            const drawTrail = (trail, color) => {
                if (trail.length < 2) return;
                ctx.beginPath();
                ctx.moveTo(trail[0].x, trail[0].y);
                for (let i = 1; i < trail.length; i++) {
                    ctx.lineTo(trail[i].x, trail[i].y);
                }
                ctx.strokeStyle = color;
                ctx.lineWidth = 1.25;
                ctx.stroke();
            };
            drawTrail(trail1, 'rgba(25,118,210,0.7)');
            drawTrail(trail2, 'rgba(239,108,0,0.7)');

            requestAnimationFrame(animate);
        }

        requestAnimationFrame(animate);
    </script>
</body>
</html>
